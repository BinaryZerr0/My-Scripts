-- FNaF Auto Farm Script
-- Automatically farms rebirth, throw, collect, and upgrade
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local CoastingLibrary

-- Configuration
local LOG_FARMING = true
local AUTO_REBIRTH_ENABLED = true
local AUTO_THROW_ENABLED = true
local AUTO_COLLECT_ENABLED = true
local AUTO_UPGRADE_ENABLED = true
local REBIRTH_DELAY = 5 -- Seconds between rebirths
local THROW_DELAY = 2 -- Seconds between throws
local COLLECT_DELAY = 1 -- Seconds between collections

-- Target remotes
local TARGET_REMOTES = {
    "Rebirth",
    "Throw", 
    "CollectSmoothie",
    "PickUpThrowable",
    "Currency",
    "Upgrade"
}

local remoteStorage = {}
local autoFarmRunning = false

-- Utility functions
local function log(message)
    if LOG_FARMING then
        print("[FNaF AutoFarm]: " .. message)
    end
end

-- Find all target remotes
local function findRemotes()
    local remotesFolder = ReplicatedStorage:FindFirstChild("Remotes")
    if not remotesFolder then
        log("Remotes folder not found!")
        return false
    end
    
    local foundCount = 0
    
    -- Search for each target remote
    for _, remoteName in ipairs(TARGET_REMOTES) do
        local remote = remotesFolder:FindFirstChild(remoteName, true) -- Recursive search
        if remote and (remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction")) then
            remoteStorage[remoteName] = remote
            foundCount = foundCount + 1
            log("Found remote: " .. remoteName)
        else
            log("Remote not found: " .. remoteName)
        end
    end
    
    log("Found " .. foundCount .. "/" .. #TARGET_REMOTES .. " target remotes")
    return foundCount > 0
end

-- Auto-farm functions
local function autoRebirth()
    if not AUTO_REBIRTH_ENABLED then
        return
    end
    
    local remote = remoteStorage["Rebirth"]
    if remote then
        if remote:IsA("RemoteEvent") then
            remote:FireServer()
            log("Auto rebirth activated!")
        elseif remote:IsA("RemoteFunction") then
            pcall(function()
                remote:InvokeServer()
                log("Auto rebirth activated!")
            end)
        end
    end
end

local function autoThrow()
    if not AUTO_THROW_ENABLED then
        return
    end
    
    local remote = remoteStorage["Throw"]
    if remote then
        if remote:IsA("RemoteEvent") then
            remote:FireServer()
            log("Auto throw activated!")
        elseif remote:IsA("RemoteFunction") then
            pcall(function()
                remote:InvokeServer()
                log("Auto throw activated!")
            end)
        end
    end
end

local function autoCollect()
    if not AUTO_COLLECT_ENABLED then
        return
    end
    
    -- Try each collection remote
    local collectRemotes = {"CollectSmoothie", "PickUpThrowable", "Currency"}
    
    for _, remoteName in ipairs(collectRemotes) do
        local remote = remoteStorage[remoteName]
        if remote then
            if remote:IsA("RemoteEvent") then
                remote:FireServer()
                log("Auto collect: " .. remoteName)
                break -- Only use the first available collection remote
            elseif remote:IsA("RemoteFunction") then
                local ok = pcall(function()
                    remote:InvokeServer()
                end)
                if ok then
                    log("Auto collect: " .. remoteName)
                    break
                end
            end
        end
    end
end

local function autoUpgrade()
    if not AUTO_UPGRADE_ENABLED then
        return
    end
    
    local remote = remoteStorage["Upgrade"]
    if remote then
        if remote:IsA("RemoteEvent") then
            remote:FireServer()
            log("Auto upgrade activated!")
        elseif remote:IsA("RemoteFunction") then
            pcall(function()
                remote:InvokeServer()
                log("Auto upgrade activated!")
            end)
        end
    end
end

-- Start auto-farm loops
local function startAutoFarm()
    if autoFarmRunning then
        log("Auto-farm already running.")
        return
    end

    autoFarmRunning = true
    log("Starting auto-farm loops...")
    
    -- Auto rebirth loop
    task.spawn(function()
        while autoFarmRunning do
            autoRebirth()
            task.wait(REBIRTH_DELAY)
        end
    end)
    
    -- Auto throw loop
    task.spawn(function()
        while autoFarmRunning do
            autoThrow()
            task.wait(THROW_DELAY)
        end
    end)
    
    -- Auto collect loop
    task.spawn(function()
        while autoFarmRunning do
            autoCollect()
            task.wait(COLLECT_DELAY)
        end
    end)
    
    -- Auto upgrade loop (slower)
    task.spawn(function()
        while autoFarmRunning do
            autoUpgrade()
            task.wait(3) -- Upgrade every 3 seconds
        end
    end)
    
    log("All auto-farm loops started!")
end

local function createCoastingUI()
    if not CoastingLibrary then
        CoastingLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/bloodball/UI-Librarys/main/(Sexy)%20Coasting%20UI%20Lib"))()
    end

    local mainTab = CoastingLibrary:CreateTab("FNaF Auto Farm")
    local mainSection = mainTab:CreateSection("Main")
    local settingsSection = mainTab:CreateSection("Settings")

    mainSection:CreateToggle("Auto Farm", function(enabled)
        if enabled then
            if findRemotes() then
                startAutoFarm()
            else
                log("No remotes found; cannot start auto farm")
            end
        else
            autoFarmRunning = false
        end
    end)

    mainSection:CreateToggle("Auto Rebirth", function(enabled)
        AUTO_REBIRTH_ENABLED = enabled
    end)

    mainSection:CreateToggle("Auto Throw", function(enabled)
        AUTO_THROW_ENABLED = enabled
    end)

    mainSection:CreateToggle("Auto Collect", function(enabled)
        AUTO_COLLECT_ENABLED = enabled
    end)

    mainSection:CreateToggle("Auto Upgrade", function(enabled)
        AUTO_UPGRADE_ENABLED = enabled
    end)

    settingsSection:CreateSlider("Rebirth Delay", 1, 30, REBIRTH_DELAY, false, function(value)
        REBIRTH_DELAY = value
    end)

    settingsSection:CreateSlider("Throw Delay", 0, 10, THROW_DELAY, false, function(value)
        THROW_DELAY = value
    end)

    settingsSection:CreateSlider("Collect Delay", 0, 10, COLLECT_DELAY, false, function(value)
        COLLECT_DELAY = value
    end)
end

-- Initialize
log("FNaF Auto Farm loaded!")
log("Type startAutoFarm() to start farming")
log("Type createCoastingUI() for GUI interface")

-- Auto-start options
-- Uncomment one of these lines to auto-start:

-- if findRemotes() then startAutoFarm() end  -- Start immediately

return {
    startAutoFarm = startAutoFarm,
    createCoastingUI = createCoastingUI,
    autoRebirth = autoRebirth,
    autoThrow = autoThrow,
    autoCollect = autoCollect,
    autoUpgrade = autoUpgrade
}
