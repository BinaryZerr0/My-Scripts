-- Arsenal Mobile Script - Compatible with Delta & Krnl
-- Optimized for mobile devices with touch controls

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local GuiService = game:GetService("GuiService")
local TweenService = game:GetService("TweenService")

local GameName = "Arsenal"
if game.PlaceId ~= 286090429 then 
    return
end

if _G.AimBotScript then
    _G.AimBotScript:Destroy() 
end

-- Mobile-optimized GUI creation with Krnl compatibility
local function CreateMobileGUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "ArsenalMobile"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.DisplayOrder = 999
    
    -- Try multiple parent options for mobile compatibility
    local success = false
    local parents = {game.CoreGui, LocalPlayer.PlayerGui, game.Players.LocalPlayer:WaitForChild("PlayerGui")}
    
    for _, parent in pairs(parents) do
        local s, e = pcall(function()
            ScreenGui.Parent = parent
        end)
        if s then
            success = true
            break
        end
    end
    
    if not success then
        warn("Failed to parent GUI - trying fallback method")
        ScreenGui.Parent = game.CoreGui
    end
    
    -- Main frame with mobile-friendly size and Krnl compatibility
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 280, 0, 350)  -- Smaller for mobile
    MainFrame.Position = UDim2.new(0, 5, 0, 30)   -- Better mobile positioning
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    MainFrame.BorderSizePixel = 0
    MainFrame.Active = true
    MainFrame.Draggable = true
    MainFrame.Visible = true  -- Explicitly set visible
    MainFrame.ZIndex = 10     -- Higher Z-index for mobile
    MainFrame.Parent = ScreenGui
    
    -- Corner rounding
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 10)
    Corner.Parent = MainFrame
    
    -- Title bar with mobile optimization
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 35)  -- Taller for mobile touch
    TitleBar.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    TitleBar.BorderSizePixel = 0
    TitleBar.Visible = true
    TitleBar.ZIndex = 11
    TitleBar.Parent = MainFrame
    
    local TitleCorner = Instance.new("UICorner")
    TitleCorner.CornerRadius = UDim.new(0, 10)
    TitleCorner.Parent = TitleBar
    
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Size = UDim2.new(1, -70, 1, 0)
    Title.Position = UDim2.new(0, 10, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "Arsenal Mobile - Krnl"
    Title.TextColor3 = Color3.new(1, 1, 1)
    Title.TextScaled = true
    Title.Font = Enum.Font.SourceSansBold  -- More compatible font
    Title.Visible = true
    Title.ZIndex = 12
    Title.Parent = TitleBar
    
    -- Minimize button with mobile touch optimization
    local MinimizeBtn = Instance.new("TextButton")
    MinimizeBtn.Name = "MinimizeBtn"
    MinimizeBtn.Size = UDim2.new(0, 30, 0, 30)  -- Larger for mobile touch
    MinimizeBtn.Position = UDim2.new(1, -35, 0, 2.5)
    MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    MinimizeBtn.Text = "-"
    MinimizeBtn.TextColor3 = Color3.fromRGB(30, 30, 30)
    MinimizeBtn.TextScaled = true
    MinimizeBtn.Font = Enum.Font.SourceSansBold
    MinimizeBtn.Visible = true
    MinimizeBtn.ZIndex = 13
    MinimizeBtn.Parent = TitleBar
    
    local MinCorner = Instance.new("UICorner")
    MinCorner.CornerRadius = UDim.new(0, 5)
    MinCorner.Parent = MinimizeBtn
    
    -- Content frame with mobile scrolling
    local ContentFrame = Instance.new("ScrollingFrame")
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Size = UDim2.new(1, -20, 1, -45)
    ContentFrame.Position = UDim2.new(0, 10, 0, 40)
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.ScrollBarThickness = 8  -- Thicker for mobile
    ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 500)
    ContentFrame.ScrollingEnabled = true
    ContentFrame.Visible = true
    ContentFrame.ZIndex = 11
    ContentFrame.Parent = MainFrame
    
    return ScreenGui, MainFrame, ContentFrame, MinimizeBtn
end

-- Debug function for mobile compatibility
local function DebugPrint(message)
    print("[Arsenal Mobile Debug]: " .. tostring(message))
end

-- Mobile-friendly button creation with Krnl compatibility
local function CreateMobileButton(parent, text, position, size, callback)
    local Button = Instance.new("TextButton")
    Button.Name = text .. "Btn"
    Button.Size = size or UDim2.new(1, -20, 0, 40)  -- Taller for mobile
    Button.Position = position
    Button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    Button.Text = text
    Button.TextColor3 = Color3.new(1, 1, 1)
    Button.TextScaled = true
    Button.Font = Enum.Font.SourceSans  -- More compatible font
    Button.Visible = true
    Button.ZIndex = 12
    Button.Parent = parent
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 5)
    ButtonCorner.Parent = Button
    
    -- Touch feedback
    Button.MouseButton1Click:Connect(function()
        local tween = TweenService:Create(Button, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(255, 100, 100)})
        tween:Play()
        tween.Completed:Connect(function()
            local tween2 = TweenService:Create(Button, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(45, 45, 45)})
            tween2:Play()
        end)
        if callback then callback() end
    end)
    
    return Button
end

-- Mobile-friendly toggle creation
local function CreateMobileToggle(parent, text, position, size, callback)
    local Frame = Instance.new("Frame")
    Frame.Name = text .. "Frame"
    Frame.Size = size or UDim2.new(1, -20, 0, 35)
    Frame.Position = position
    Frame.BackgroundTransparency = 1
    Frame.Parent = parent
    
    local Label = Instance.new("TextLabel")
    Label.Name = "Label"
    Label.Size = UDim2.new(0.65, 0, 1, 0)
    Label.Position = UDim2.new(0, 0, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = text
    Label.TextColor3 = Color3.new(1, 1, 1)
    Label.TextScaled = true
    Label.Font = Enum.Font.SourceSans
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Visible = true
    Label.ZIndex = 12
    Label.Parent = Frame
    
    local Toggle = Instance.new("TextButton")
    Toggle.Name = "Toggle"
    Toggle.Size = UDim2.new(0, 60, 0, 30)  -- Larger for mobile touch
    Toggle.Position = UDim2.new(1, -65, 0, 2.5)
    Toggle.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    Toggle.Text = "ON"
    Toggle.TextColor3 = Color3.new(1, 1, 1)
    Toggle.TextScaled = true
    Toggle.Font = Enum.Font.SourceSansBold
    Toggle.Visible = true
    Toggle.ZIndex = 12
    Toggle.Parent = Frame
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 12)
    ToggleCorner.Parent = Toggle
    
    local isEnabled = true
    Toggle.MouseButton1Click:Connect(function()
        isEnabled = not isEnabled
        Toggle.Text = isEnabled and "ON" or "OFF"
        Toggle.BackgroundColor3 = isEnabled and Color3.fromRGB(255, 100, 100) or Color3.fromRGB(100, 100, 100)
        if callback then callback(isEnabled) end
    end)
    
    return Frame, Toggle, function() return isEnabled end
end

-- Initialize mobile GUI with error handling
DebugPrint("Initializing mobile GUI...")
local ScreenGui, MainFrame, ContentFrame, MinimizeBtn

local success, error = pcall(function()
    ScreenGui, MainFrame, ContentFrame, MinimizeBtn = CreateMobileGUI()
end)

if not success then
    DebugPrint("GUI Creation Failed: " .. tostring(error))
    return
else
    DebugPrint("GUI Created Successfully!")
end

-- Variables
local Enabled = true
local FOV = 100
local Smoothing = 0.1
local SilentAimEnabled = false
local HitboxSize = 13
local HitboxTransparency = 10
local ShowFOVCircle = true
local ShowESP = false
local ESPColor = Color3.fromRGB(255, 100, 100)

-- Mobile input handling
local TouchEnabled = UserInputService.TouchEnabled
local connections = {}
local silentAimConnections = {}
local ESPDrawings = {}

-- FOV Circle (mobile-optimized)
local FOVCircle = Drawing.new("Circle")
FOVCircle.Color = Color3.fromRGB(255, 100, 100)
FOVCircle.Thickness = 2
FOVCircle.Transparency = 0.5
FOVCircle.Filled = false
FOVCircle.Radius = FOV
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

-- Mobile-optimized target acquisition
local function GetClosestPlayerToCenter()
    local closestPlayer = nil
    local shortestDistance = math.huge
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            if player.Team ~= LocalPlayer.Team then
                local head = player.Character.Head
                local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
                
                if onScreen then
                    local distance = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
                    if distance < FOV and distance < shortestDistance then
                        closestPlayer = player
                        shortestDistance = distance
                    end
                end
            end
        end
    end
    
    return closestPlayer
end

-- Mobile aimbot function
local function MobileAimbot()
    if not Enabled then return end
    
    local target = GetClosestPlayerToCenter()
    if target and target.Character and target.Character:FindFirstChild("Head") then
        local head = target.Character.Head
        local targetPosition = head.Position + head.Velocity * 0.1 -- Prediction
        
        -- Smooth camera movement for mobile
        local currentCFrame = Camera.CFrame
        local targetCFrame = CFrame.lookAt(currentCFrame.Position, targetPosition)
        
        Camera.CFrame = currentCFrame:Lerp(targetCFrame, Smoothing)
    end
end

-- Verify GUI is visible
wait(0.1)
if ScreenGui and ScreenGui.Parent then
    DebugPrint("GUI Parent: " .. tostring(ScreenGui.Parent.Name))
    DebugPrint("MainFrame Visible: " .. tostring(MainFrame.Visible))
else
    DebugPrint("WARNING: GUI not properly parented!")
end

-- Create mobile UI elements
local yPos = 10

-- Aimbot section
local AimbotLabel = Instance.new("TextLabel")
AimbotLabel.Size = UDim2.new(1, -20, 0, 25)
AimbotLabel.Position = UDim2.new(0, 10, 0, yPos)
AimbotLabel.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
AimbotLabel.Text = "AIMBOT"
AimbotLabel.TextColor3 = Color3.new(1, 1, 1)
AimbotLabel.TextScaled = true
AimbotLabel.Font = Enum.Font.GothamBold
AimbotLabel.Parent = ContentFrame

local LabelCorner = Instance.new("UICorner")
LabelCorner.CornerRadius = UDim.new(0, 5)
LabelCorner.Parent = AimbotLabel

yPos = yPos + 35

local _, AimbotToggle, GetAimbotState = CreateMobileToggle(ContentFrame, "Enable Aimbot", UDim2.new(0, 10, 0, yPos), UDim2.new(1, -20, 0, 40), function(state)
    Enabled = state
    DebugPrint("Aimbot toggled: " .. tostring(state))
end)

yPos = yPos + 45

-- FOV Circle toggle
local _, FOVToggle, GetFOVState = CreateMobileToggle(ContentFrame, "Show FOV Circle", UDim2.new(0, 10, 0, yPos), nil, function(state)
    ShowFOVCircle = state
    FOVCircle.Visible = state
end)

yPos = yPos + 45

-- ESP section
local ESPLabel = Instance.new("TextLabel")
ESPLabel.Size = UDim2.new(1, -20, 0, 25)
ESPLabel.Position = UDim2.new(0, 10, 0, yPos)
ESPLabel.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
ESPLabel.Text = "ESP"
ESPLabel.TextColor3 = Color3.new(1, 1, 1)
ESPLabel.TextScaled = true
ESPLabel.Font = Enum.Font.GothamBold
ESPLabel.Parent = ContentFrame

local ESPCorner = Instance.new("UICorner")
ESPCorner.CornerRadius = UDim.new(0, 5)
ESPCorner.Parent = ESPLabel

yPos = yPos + 35

local _, ESPToggle, GetESPState = CreateMobileToggle(ContentFrame, "Enable ESP", UDim2.new(0, 10, 0, yPos), nil, function(state)
    ShowESP = state
end)

yPos = yPos + 45

-- Silent Aim section
local SilentLabel = Instance.new("TextLabel")
SilentLabel.Size = UDim2.new(1, -20, 0, 25)
SilentLabel.Position = UDim2.new(0, 10, 0, yPos)
SilentLabel.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
SilentLabel.Text = "SILENT AIM"
SilentLabel.TextColor3 = Color3.new(1, 1, 1)
SilentLabel.TextScaled = true
SilentLabel.Font = Enum.Font.GothamBold
SilentLabel.Parent = ContentFrame

local SilentCorner = Instance.new("UICorner")
SilentCorner.CornerRadius = UDim.new(0, 5)
SilentCorner.Parent = SilentLabel

yPos = yPos + 35

local _, SilentToggle, GetSilentState = CreateMobileToggle(ContentFrame, "Enable Silent Aim", UDim2.new(0, 10, 0, yPos), nil, function(state)
    SilentAimEnabled = state
end)

yPos = yPos + 55

-- Quick action buttons
CreateMobileButton(ContentFrame, "Reset All", UDim2.new(0, 10, 0, yPos), UDim2.new(0.48, 0, 0, 35), function()
    Enabled = false
    SilentAimEnabled = false
    ShowESP = false
    ShowFOVCircle = false
    FOVCircle.Visible = false
    
    -- Update toggles
    AimbotToggle.Text = "OFF"
    AimbotToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    ESPToggle.Text = "OFF"
    ESPToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    SilentToggle.Text = "OFF"
    SilentToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    FOVToggle.Text = "OFF"
    FOVToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
end)

CreateMobileButton(ContentFrame, "Destroy GUI", UDim2.new(0.52, 0, 0, yPos), UDim2.new(0.48, 0, 0, 35), function()
    ScreenGui:Destroy()
    if connections.aimbot then connections.aimbot:Disconnect() end
    if connections.esp then connections.esp:Disconnect() end
    FOVCircle:Remove()
    _G.AimBotScript = nil
end)

-- Minimize functionality
local isMinimized = false
MinimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.new(0, 300, 0, 30) or UDim2.new(0, 300, 0, 400)
    local tween = TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = targetSize})
    tween:Play()
    MinimizeBtn.Text = isMinimized and "+" or "-"
end)

-- Enhanced ESP Functions with full skeleton for mobile
local function CreateESPForPlayer(player)
    if ESPDrawings[player] then return end
    
    ESPDrawings[player] = {
        -- Main spine
        Spine = Drawing.new("Line"),
        -- Arms
        LeftUpperArm = Drawing.new("Line"),
        RightUpperArm = Drawing.new("Line"),
        LeftLowerArm = Drawing.new("Line"),
        RightLowerArm = Drawing.new("Line"),
        -- Legs
        LeftUpperLeg = Drawing.new("Line"),
        RightUpperLeg = Drawing.new("Line"),
        LeftLowerLeg = Drawing.new("Line"),
        RightLowerLeg = Drawing.new("Line"),
        -- Additional connections
        LeftShoulder = Drawing.new("Line"),
        RightShoulder = Drawing.new("Line"),
        LeftHip = Drawing.new("Line"),
        RightHip = Drawing.new("Line")
    }
    
    for _, drawing in pairs(ESPDrawings[player]) do
        drawing.Color = ESPColor
        drawing.Thickness = 3  -- Thicker for mobile visibility
        drawing.Transparency = 0.8  -- More visible
        drawing.Visible = false
    end
    
    DebugPrint("Created ESP for player: " .. player.Name)
end

-- Main loops
connections.aimbot = RunService.Heartbeat:Connect(function()
    if TouchEnabled then
        MobileAimbot()
    end
    
    -- Update FOV circle
    if ShowFOVCircle then
        FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
        FOVCircle.Radius = FOV
        FOVCircle.Visible = true
    else
        FOVCircle.Visible = false
    end
end)

-- ESP Update loop
connections.esp = RunService.Heartbeat:Connect(function()
    if not ShowESP then
        for _, drawings in pairs(ESPDrawings) do
            for _, drawing in pairs(drawings) do
                drawing.Visible = false
            end
        end
        return
    end
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            CreateESPForPlayer(player)
        end
    end
    
    -- Enhanced ESP Update with full skeleton
    for player, drawings in pairs(ESPDrawings) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            if player.Team ~= LocalPlayer.Team then
                local character = player.Character
                local humanoid = character:FindFirstChild("Humanoid")
                
                -- Get body parts (R15 and R6 compatible)
                local head = character:FindFirstChild("Head")
                local torso = character:FindFirstChild("Torso") or character:FindFirstChild("UpperTorso")
                local leftArm = character:FindFirstChild("Left Arm") or character:FindFirstChild("LeftUpperArm")
                local rightArm = character:FindFirstChild("Right Arm") or character:FindFirstChild("RightUpperArm")
                local leftLeg = character:FindFirstChild("Left Leg") or character:FindFirstChild("LeftUpperLeg")
                local rightLeg = character:FindFirstChild("Right Leg") or character:FindFirstChild("RightUpperLeg")
                
                -- R15 specific parts
                local leftLowerArm = character:FindFirstChild("LeftLowerArm")
                local rightLowerArm = character:FindFirstChild("RightLowerArm")
                local leftLowerLeg = character:FindFirstChild("LeftLowerLeg")
                local rightLowerLeg = character:FindFirstChild("RightLowerLeg")
                local leftHand = character:FindFirstChild("LeftHand")
                local rightHand = character:FindFirstChild("RightHand")
                local leftFoot = character:FindFirstChild("LeftFoot")
                local rightFoot = character:FindFirstChild("RightFoot")
                
                if head and torso then
                    local headPos, headOnScreen = Camera:WorldToViewportPoint(head.Position)
                    local torsoPos, torsoOnScreen = Camera:WorldToViewportPoint(torso.Position)
                    
                    if headOnScreen and torsoOnScreen then
                        -- Main spine (head to torso)
                        drawings.Spine.From = Vector2.new(headPos.X, headPos.Y)
                        drawings.Spine.To = Vector2.new(torsoPos.X, torsoPos.Y)
                        drawings.Spine.Visible = true
                        
                        -- Left arm chain
                        if leftArm then
                            local leftArmPos, leftArmOnScreen = Camera:WorldToViewportPoint(leftArm.Position)
                            if leftArmOnScreen then
                                drawings.LeftShoulder.From = Vector2.new(torsoPos.X, torsoPos.Y)
                                drawings.LeftShoulder.To = Vector2.new(leftArmPos.X, leftArmPos.Y)
                                drawings.LeftShoulder.Visible = true
                                
                                if leftLowerArm then
                                    local leftLowerArmPos, leftLowerArmOnScreen = Camera:WorldToViewportPoint(leftLowerArm.Position)
                                    if leftLowerArmOnScreen then
                                        drawings.LeftUpperArm.From = Vector2.new(leftArmPos.X, leftArmPos.Y)
                                        drawings.LeftUpperArm.To = Vector2.new(leftLowerArmPos.X, leftLowerArmPos.Y)
                                        drawings.LeftUpperArm.Visible = true
                                        
                                        if leftHand then
                                            local leftHandPos, leftHandOnScreen = Camera:WorldToViewportPoint(leftHand.Position)
                                            if leftHandOnScreen then
                                                drawings.LeftLowerArm.From = Vector2.new(leftLowerArmPos.X, leftLowerArmPos.Y)
                                                drawings.LeftLowerArm.To = Vector2.new(leftHandPos.X, leftHandPos.Y)
                                                drawings.LeftLowerArm.Visible = true
                                            end
                                        end
                                    end
                                else
                                    -- R6 compatibility - direct arm connection
                                    drawings.LeftUpperArm.From = Vector2.new(torsoPos.X, torsoPos.Y)
                                    drawings.LeftUpperArm.To = Vector2.new(leftArmPos.X, leftArmPos.Y)
                                    drawings.LeftUpperArm.Visible = true
                                end
                            end
                        end
                        
                        -- Right arm chain
                        if rightArm then
                            local rightArmPos, rightArmOnScreen = Camera:WorldToViewportPoint(rightArm.Position)
                            if rightArmOnScreen then
                                drawings.RightShoulder.From = Vector2.new(torsoPos.X, torsoPos.Y)
                                drawings.RightShoulder.To = Vector2.new(rightArmPos.X, rightArmPos.Y)
                                drawings.RightShoulder.Visible = true
                                
                                if rightLowerArm then
                                    local rightLowerArmPos, rightLowerArmOnScreen = Camera:WorldToViewportPoint(rightLowerArm.Position)
                                    if rightLowerArmOnScreen then
                                        drawings.RightUpperArm.From = Vector2.new(rightArmPos.X, rightArmPos.Y)
                                        drawings.RightUpperArm.To = Vector2.new(rightLowerArmPos.X, rightLowerArmPos.Y)
                                        drawings.RightUpperArm.Visible = true
                                        
                                        if rightHand then
                                            local rightHandPos, rightHandOnScreen = Camera:WorldToViewportPoint(rightHand.Position)
                                            if rightHandOnScreen then
                                                drawings.RightLowerArm.From = Vector2.new(rightLowerArmPos.X, rightLowerArmPos.Y)
                                                drawings.RightLowerArm.To = Vector2.new(rightHandPos.X, rightHandPos.Y)
                                                drawings.RightLowerArm.Visible = true
                                            end
                                        end
                                    end
                                else
                                    -- R6 compatibility
                                    drawings.RightUpperArm.From = Vector2.new(torsoPos.X, torsoPos.Y)
                                    drawings.RightUpperArm.To = Vector2.new(rightArmPos.X, rightArmPos.Y)
                                    drawings.RightUpperArm.Visible = true
                                end
                            end
                        end
                        
                        -- Left leg chain
                        if leftLeg then
                            local leftLegPos, leftLegOnScreen = Camera:WorldToViewportPoint(leftLeg.Position)
                            if leftLegOnScreen then
                                drawings.LeftHip.From = Vector2.new(torsoPos.X, torsoPos.Y)
                                drawings.LeftHip.To = Vector2.new(leftLegPos.X, leftLegPos.Y)
                                drawings.LeftHip.Visible = true
                                
                                if leftLowerLeg then
                                    local leftLowerLegPos, leftLowerLegOnScreen = Camera:WorldToViewportPoint(leftLowerLeg.Position)
                                    if leftLowerLegOnScreen then
                                        drawings.LeftUpperLeg.From = Vector2.new(leftLegPos.X, leftLegPos.Y)
                                        drawings.LeftUpperLeg.To = Vector2.new(leftLowerLegPos.X, leftLowerLegPos.Y)
                                        drawings.LeftUpperLeg.Visible = true
                                        
                                        if leftFoot then
                                            local leftFootPos, leftFootOnScreen = Camera:WorldToViewportPoint(leftFoot.Position)
                                            if leftFootOnScreen then
                                                drawings.LeftLowerLeg.From = Vector2.new(leftLowerLegPos.X, leftLowerLegPos.Y)
                                                drawings.LeftLowerLeg.To = Vector2.new(leftFootPos.X, leftFootPos.Y)
                                                drawings.LeftLowerLeg.Visible = true
                                            end
                                        end
                                    end
                                else
                                    -- R6 compatibility
                                    drawings.LeftUpperLeg.From = Vector2.new(torsoPos.X, torsoPos.Y)
                                    drawings.LeftUpperLeg.To = Vector2.new(leftLegPos.X, leftLegPos.Y)
                                    drawings.LeftUpperLeg.Visible = true
                                end
                            end
                        end
                        
                        -- Right leg chain
                        if rightLeg then
                            local rightLegPos, rightLegOnScreen = Camera:WorldToViewportPoint(rightLeg.Position)
                            if rightLegOnScreen then
                                drawings.RightHip.From = Vector2.new(torsoPos.X, torsoPos.Y)
                                drawings.RightHip.To = Vector2.new(rightLegPos.X, rightLegPos.Y)
                                drawings.RightHip.Visible = true
                                
                                if rightLowerLeg then
                                    local rightLowerLegPos, rightLowerLegOnScreen = Camera:WorldToViewportPoint(rightLowerLeg.Position)
                                    if rightLowerLegOnScreen then
                                        drawings.RightUpperLeg.From = Vector2.new(rightLegPos.X, rightLegPos.Y)
                                        drawings.RightUpperLeg.To = Vector2.new(rightLowerLegPos.X, rightLowerLegPos.Y)
                                        drawings.RightUpperLeg.Visible = true
                                        
                                        if rightFoot then
                                            local rightFootPos, rightFootOnScreen = Camera:WorldToViewportPoint(rightFoot.Position)
                                            if rightFootOnScreen then
                                                drawings.RightLowerLeg.From = Vector2.new(rightLowerLegPos.X, rightLowerLegPos.Y)
                                                drawings.RightLowerLeg.To = Vector2.new(rightFootPos.X, rightFootPos.Y)
                                                drawings.RightLowerLeg.Visible = true
                                            end
                                        end
                                    end
                                else
                                    -- R6 compatibility
                                    drawings.RightUpperLeg.From = Vector2.new(torsoPos.X, torsoPos.Y)
                                    drawings.RightUpperLeg.To = Vector2.new(rightLegPos.X, rightLegPos.Y)
                                    drawings.RightUpperLeg.Visible = true
                                end
                            end
                        end
                        
                    else
                        -- Hide all if not on screen
                        for _, element in pairs(drawings) do
                            element.Visible = false
                        end
                    end
                else
                    -- Hide all if no head/torso
                    for _, element in pairs(drawings) do
                        element.Visible = false
                    end
                end
            else
                -- Hide ESP for same team
                for _, element in pairs(drawings) do
                    element.Visible = false
                end
            end
        else
            -- Hide ESP for invalid players
            for _, element in pairs(drawings) do
                element.Visible = false
            end
        end
    end
end)

-- Player cleanup
Players.PlayerRemoving:Connect(function(player)
    if ESPDrawings[player] then
        for _, drawing in pairs(ESPDrawings[player]) do
            drawing:Remove()
        end
        ESPDrawings[player] = nil
    end
end)

-- Store reference for cleanup
_G.AimBotScript = ScreenGui

-- Final status check
DebugPrint("=== Arsenal Mobile Script Status ===")
DebugPrint("Script Loaded: SUCCESS")
DebugPrint("Executor: Krnl Compatible")
DebugPrint("Touch Interface: Ready")
DebugPrint("GUI Visible: " .. tostring(MainFrame and MainFrame.Visible))
DebugPrint("=====================================")

print("Arsenal Mobile Script Loaded Successfully!")
print("Compatible with Delta & Krnl executors")
print("Touch-optimized interface ready!")
print("If GUI is not visible, check console for debug info!")
